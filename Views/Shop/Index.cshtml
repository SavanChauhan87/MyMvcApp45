@model List<MyMvcApp.Models.Product>
@{
    ViewData["Title"] = "Pharmacy Store";
    var username = Context.Session.GetString("Username");
    var userFullName = Context.Session.GetString("UserFullName");
    var userRole = Context.Session.GetString("UserRole");
}

<div class="container-fluid">
    <!-- User Header -->
    <div class="row mb-3">
        <div class="col-12">
            <div class="card bg-primary text-white">
                <div class="card-body py-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h4 class="mb-1">Welcome, @userFullName!</h4>
                            <p class="mb-0">Role: @userRole | Username: @username</p>
                        </div>
                        <div class="d-flex gap-2">
                            <a asp-controller="Shop" asp-action="Cart" class="btn btn-light">
                                üõí Cart
                            </a>
                            <a asp-controller="Auth" asp-action="Logout" class="btn btn-outline-light">
                                <i class="fas fa-sign-out-alt me-2"></i>Logout
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Hero Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-gradient-primary text-white">
                <div class="card-body text-center py-5">
                    <h1 class="display-4">üè• Welcome to Our Pharmacy</h1>
                    <p class="lead">Your trusted source for quality medications and health products</p>
                    <div class="d-flex justify-content-center gap-3">
                        <a asp-controller="Shop" asp-action="Search" class="btn btn-light btn-lg">
                            üîç Search Products
                        </a>
                        <a asp-controller="Shop" asp-action="Cart" class="btn btn-outline-light btn-lg">
                            üõí View Cart
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Categories Section -->
    <div class="row mb-4">
        <div class="col-12">
            <h3>üíä Browse Categories</h3>
            <p class="text-muted">Find medications by category</p>
        </div>
    </div>

    <div class="row mb-5">
        <div class="col-md-3 mb-3">
            <a asp-controller="Shop" asp-action="Category" asp-route-category="Pain Relief" class="text-decoration-none">
                <div class="card text-center h-100 category-card">
                    <div class="card-body">
                        <span style="font-size: 3rem;">üíä</span>
                        <h5 class="card-title">Pain Relief</h5>
                        <p class="card-text text-muted">Pain medications and analgesics</p>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-md-3 mb-3">
            <a asp-controller="Shop" asp-action="Category" asp-route-category="Antibiotics" class="text-decoration-none">
                <div class="card text-center h-100 category-card">
                    <div class="card-body">
                        <span style="font-size: 3rem;">ü¶†</span>
                        <h5 class="card-title">Antibiotics</h5>
                        <p class="card-text text-muted">Prescription antibiotics</p>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-md-3 mb-3">
            <a asp-controller="Shop" asp-action="Category" asp-route-category="Vitamins" class="text-decoration-none">
                <div class="card text-center h-100 category-card">
                    <div class="card-body">
                        <span style="font-size: 3rem;">ü•¨</span>
                        <h5 class="card-title">Vitamins</h5>
                        <p class="card-text text-muted">Vitamins and supplements</p>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-md-3 mb-3">
            <a asp-controller="Shop" asp-action="Category" asp-route-category="Digestive Health" class="text-decoration-none">
                <div class="card text-center h-100 category-card">
                    <div class="card-body">
                        <span style="font-size: 3rem;">ü´Ä</span>
                        <h5 class="card-title">Digestive Health</h5>
                        <p class="card-text text-muted">Digestive medications</p>
                    </div>
                </div>
            </a>
        </div>
    </div>

    <!-- Products Section -->
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3>üõçÔ∏è All Products</h3>
                <div class="d-flex gap-2">
                    <input type="text" id="searchInput" class="form-control" placeholder="Search products..." style="width: 250px;">
                    <button onclick="searchProducts()" class="btn btn-outline-primary">üîç</button>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        @foreach (var product in Model)
        {
            <div class="col-md-4 col-lg-3 mb-4 product-item">
                <div class="card h-100 product-card">
                    <div class="card-body">
                        <div class="text-center mb-3">
                            @if (!string.IsNullOrEmpty(product.ImageUrl))
                            {
                                <img src="@product.ImageUrl" alt="@product.Name" class="product-image" style="max-width: 100%; max-height: 150px; object-fit: contain;">
                            }
                            else
                            {
                                <span style="font-size: 3rem;">üíä</span>
                            }
                        </div>
                        <h5 class="card-title">@product.Name</h5>
                        <p class="card-text text-muted">@product.Description</p>
                        <div class="mb-2">
                            <span class="badge bg-primary">@product.Category</span>
                            @if (false)
                            {
                                <span class="badge bg-warning">Prescription Required</span>
                            }
                        </div>
                        <p class="card-text">
                            <strong>Strength:</strong> @product.Strength<br>
                            <strong>Form:</strong> @product.DosageForm<br>
                            <strong>Stock:</strong> @product.StockQuantity units
                        </p>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="h5 text-primary mb-0">$@product.Price</span>
                            <div class="d-flex gap-2">
                                <a asp-controller="Shop" asp-action="Product" asp-route-id="@product.Id" class="btn btn-outline-primary btn-sm">
                                    View
                                </a>
                                <button onclick="addToCart(@product.Id)" class="btn btn-success btn-sm">
                                    üõí Add
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>

    <!-- Call to Action -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="card bg-light">
                <div class="card-body text-center">
                    <h4>üìã Need a Prescription?</h4>
                    <p class="lead">Upload your prescription for prescription-only medications</p>
                    <a asp-controller="Shop" asp-action="PrescriptionUpload" class="btn btn-success btn-lg">
                        üì§ Upload Prescription
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function addToCart(productId) {
            fetch('/Shop/AddToCart', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `productId=${productId}&quantity=1`
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Product added to cart successfully!');
                } else {
                    alert(data.message || 'Failed to add product to cart');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to add product to cart');
            });
        }

        function searchProducts() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            if (searchTerm) {
                window.location.href = `/Shop/Search?query=${encodeURIComponent(searchTerm)}`;
            }
        }

        // Allow Enter key to trigger search
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchProducts();
            }
        });
    </script>
}

<style>
    .product-card {
        transition: transform 0.2s, box-shadow 0.2s;
        border: 1px solid #dee2e6;
    }
    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    .category-card {
        transition: transform 0.2s, box-shadow 0.2s;
        border: 1px solid #dee2e6;
    }
    .category-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }
    .card {
        border-radius: 10px;
    }
    .btn {
        border-radius: 8px;
    }
    .product-image {
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .bg-gradient-primary {
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
    }
</style>
